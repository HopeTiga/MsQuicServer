# MsQuicServer
# MsQuic 项目分析
## 项目概述
这是一个基于 MsQuic 库实现的 QUIC 协议通信框架，主要用于高性能、安全的网络数据传输。项目实现了客户端-服务器架构，支持普通消息传输和文件传输功能。QUIC 协议作为一种基于 UDP 的传输层协议，提供了类似 TCP 的可靠性，同时具有更低的延迟和更好的多路复用能力。

## 项目主要功能
1. QUIC 服务器 ：监听连接请求，管理多个客户端连接
2. QUIC 客户端 ：连接到服务器，发送和接收数据
3. 会话管理 ：维护客户端和服务器之间的通信会话
4. 文件传输 ：支持大文件和小文件的高效传输
5. 多线程任务池 ：处理异步任务，提高性能
## 项目结构
### 核心类
1. MsQuicServer
   
   - 负责初始化 QUIC 服务器
   - 监听客户端连接请求
   - 管理连接和会话
2. MsQuicClient
   
   - 负责连接到 QUIC 服务器
   - 发送和接收数据
   - 管理客户端会话
3. MsQuicSession
   
   - 表示一个 QUIC 连接会话
   - 管理数据流的创建和使用
   - 处理消息的发送和接收
4. MsQuicFileTransfer
   
   - 处理文件传输逻辑
   - 支持大文件直接写入磁盘
   - 支持小文件内存缓存
5. MsQuicThreadTaskPool
   
   - 线程池实现
   - 处理异步任务
### 文件组织
```plaintext
MsQuic/
├── MsQuicServer.h/cpp       - 服务器实现
├── MsQuicClient.h/cpp       - 客户端实现
├── MsQuicSession.h/cpp      - 会话管理
├── MsQuicFileTransfer.h/cpp - 文件传输
├── MsQuicClientFileTransfer.h/cpp - 客户端文件传输
├── MsQuicHandlerSystem.h/cpp - 处理系统
├── MsQuicThreadTaskPool.h/cpp - 线程池
├── MsQuicWriterNode.h       - 写入节点
├── Utils.h/cpp              - 工具函数
└── main.cpp                 - 程序入口
 ```
```

## 工作流程
### 服务器端
1. 初始化 MsQuic API
2. 创建 QUIC 监听器
3. 等待客户端连接
4. 当客户端连接时，创建 MsQuicSession 对象
5. 处理来自客户端的数据和文件传输请求
### 客户端
1. 初始化 MsQuic API
2. 连接到服务器
3. 创建数据流
4. 发送/接收数据或文件
### 文件传输流程
1. 发送方构造文件头信息（文件名、消息ID、文件大小、元数据）
2. 接收方解析头信息
3. 根据文件大小决定存储方式（内存或磁盘）
4. 接收数据并写入
5. 完成接收后调用回调函数
## 技术特点
1. 异步回调机制 ：使用回调函数处理各种事件
2. 流控制 ：管理数据流的创建和使用
3. 内存管理 ：优化大数据块的处理
4. 错误处理 ：全面的错误检查和异常处理
5. 线程安全 ：使用互斥锁保护共享资源
## 性能优化
1. 分块传输 ：大文件分块发送，避免内存压力
2. 直接磁盘写入 ：大文件直接写入磁盘，避免内存溢出
3. 线程池 ：使用线程池处理异步任务
4. 缓冲区优化 ：根据 QUIC 协议特性优化缓冲区大小
